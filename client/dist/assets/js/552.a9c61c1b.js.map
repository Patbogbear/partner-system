{"version":3,"file":"assets/js/552.a9c61c1b.js","mappings":"yqIAmVA,MAAMA,GAAQC,EAAAA,EAAAA,MACRC,GAAeC,EAAAA,EAAAA,KAAS,IAAMH,EAAMI,QAAQC,OAC5CC,GAAcC,EAAAA,EAAAA,IAAI,IAClBC,GAAqBD,EAAAA,EAAAA,IAAI,IACzBE,GAAWF,EAAAA,EAAAA,IAAI,IACfG,IAAgBH,EAAAA,EAAAA,IAAI,IACpBI,IAAeJ,EAAAA,EAAAA,IAAI,IAEnBK,KADkBL,EAAAA,EAAAA,IAAI,KACPA,EAAAA,EAAAA,IAAI,KACnBM,IAAkBN,EAAAA,EAAAA,IAAI,IACtBO,IAAkBP,EAAAA,EAAAA,IAAI,IACtBQ,IAAcR,EAAAA,EAAAA,IAAI,IAClBS,IAAcT,EAAAA,EAAAA,IAAI,KAGxBU,EAAAA,EAAAA,KAAUC,gBACFC,WACAC,GAAalB,EAAa,IAGlC,MAAMiB,GAAWD,UACf,IACE,IAAI,KAAEG,SAAeC,EAAAA,EAAAA,IAAU,cAC/Bb,EAASc,MAAQF,CACnB,CAAE,MAAOG,GAAQ,GAEbC,GAAiBA,KACjBnB,EAAYiB,QAAUf,EAAmBe,MAI7CD,EAAAA,EAAAA,KACQ,gCAAiC,CACrChB,YAAaA,EAAYiB,QAE1BG,MAAMC,IACLC,QAAQC,IAAI,gCAAgC,IAE7CC,OAAON,IACNI,QAAQC,IAAI,4BAA4B,IAX1CE,MAAM,qBAYJ,EAGAC,GAAad,UACjB,UACQI,EAAAA,EAAAA,UAAa,yBAA0B,CAC3CD,KAAM,CAAEY,MAAOvB,GAAca,eAEzBJ,KACNT,GAAgB,IAClB,CAAE,MAAOc,GACPI,QAAQC,IAAI,uBAAwBL,EACtC,GAEIU,GAAiBhB,UACrB,UACQI,EAAAA,EAAAA,IAAU,uBAAwB,CACtCW,MAAOvB,GAAca,MACrBY,gBAAiBxB,GAAaY,cAG1BJ,IACR,CAAE,MAAOK,GACPI,QAAQC,IAAI,0BAA2BL,EACzC,GAGIY,GAAUlB,UACd,UACQI,EAAAA,EAAAA,KAAW,sBAAuB,CACtCe,KAAMtB,GAAYQ,MAClBU,MAAOrB,GAAaW,MACpBe,SAAUzB,GAAgBU,MAC1BgB,SAAUzB,GAAgBS,cAEtBJ,IACR,CAAE,MAAOK,GACPI,QAAQC,IAAI,kBAAmBL,EACjC,GAGIJ,GAAeF,UACnB,IAEE,GADAU,QAAQC,IAAI3B,GACwB,gBAAhCA,EAAaqB,MAAMgB,SAA4B,CAEjD,IAAI,KAAElB,SAAeC,EAAAA,EAAAA,IAAU,iCAAkC,CAC/DkB,OAAQ,CAAEC,OAAQ,aAEpBzB,GAAYO,MAAQF,EACpBO,QAAQC,IAAIb,GACd,MAAO,GAAoC,UAAhCd,EAAaqB,MAAMgB,UAAwD,gBAAhCrC,EAAaqB,MAAMgB,SAA4B,CACnG,IAAI,KAAElB,SAAeC,EAAAA,EAAAA,IAAW,mCAAkCpB,EAAaqB,MAAMmB,MAErF1B,GAAYO,MAAQF,CACtB,CAEAO,QAAQC,IAAIb,GAAYO,MAC1B,CAAE,MAAOC,GACPI,QAAQC,IAAI,yBAA0BL,EACxC,GAIImB,GAAiBzB,UACrB,UACQI,EAAAA,EAAAA,IAAU,kCAAoCC,EAAO,CACzDkB,OAAQ,YAEZ,CAAE,MAAOjB,GACPI,QAAQC,IAAI,wBAAyBL,EACvC,GAEIoB,GAAc1B,UAClB,UACQI,EAAAA,EAAAA,IAAU,kCAAoCC,EAAO,CACzDkB,OAAQ,UAEZ,CAAE,MAAOjB,GACPI,QAAQC,IAAI,wBAAyBL,EACvC,G,8uJCxcF,MAAMqB,GAAc,GAEpB,S","sources":["webpack://client/./src/views/Personal.vue","webpack://client/./src/views/Personal.vue?da89"],"sourcesContent":["<template>\n  <div>\n    <div class=\"header\">\n      <div class=\"row\">\n        <div class=\"col-xl-4\">\n          <div class=\"row\">\n            <div class=\"card\">\n              <div class=\"card-body text-center\">\n                <div class=\"mb-3\">\n                  <span\n                    class=\"avatar avatar-xl rounded\"\n                   \n                  ></span>\n                </div>\n                <div class=\"card-title mb-1\">{{ userIdentity.name }}</div>\n                <div class=\"text-secondary\">{{ userIdentity.identity }}</div>\n              </div>\n            </div>\n          </div>\n          <form>\n            <fieldset class=\"form-fieldset\">\n              <div class=\"card-header\">\n                <h3 class=\"card-title\">Change Password</h3>\n              </div>\n              <div class=\"mb-3\">\n                <label class=\"form-label\">New Password</label>\n                <input\n                  type=\"text\"\n                  class=\"form-control\"\n                  placeholder=\"new password\"\n                  v-model=\"newPassword\"\n                />\n              </div>\n              <div class=\"mb-3\">\n                <label class=\"form-label\">Confrim New Password</label>\n                <input\n                  type=\"text\"\n                  class=\"form-control\"\n                  placeholder=\"confrim new password\"\n                  v-model=\"confirmNewPassword\"\n                />\n              </div>\n            </fieldset>\n            <div class=\"card-footer text-end\">\n              <button\n                type=\"submit\"\n                class=\"btn btn-primary\"\n                @click=\"changePassword()\"\n              >\n                Change Password\n              </button>\n            </div>\n          </form>\n          <form @submit.prevent=\"addUser\" v-if=\"userIdentity.identity === 'Super-Admin'\">\n            <fieldset class=\"form-fieldset\">\n              <div class=\"card-header\">\n                <h3 class=\"card-title\">Add user</h3>\n              </div>\n              <div class=\"card-body\">\n                <div class=\"mb-3\">\n                  <label class=\"form-label required\">User name</label>\n                  <div>\n                    <input\n                      type=\"name\"\n                      class=\"form-control\"\n                      placeholder=\"Enter name\"\n                      v-model=\"addUserName\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div class=\"mb-3\">\n                  <label class=\"form-label required\">Email address</label>\n                  <div>\n                    <input\n                      type=\"email\"\n                      class=\"form-control\"\n                      aria-describedby=\"emailHelp\"\n                      placeholder=\"Enter email\"\n                      v-model=\"addUserEmail\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div class=\"mb-3\">\n                  <label class=\"form-label required\">Password</label>\n                  <div>\n                    <input\n                      type=\"password\"\n                      class=\"form-control\"\n                      placeholder=\"Password\"\n                      v-model=\"addUserPassword\"\n                      required\n                    />\n                  </div>\n                </div>\n\n                <div class=\"mb-3\">\n                  <label class=\"form-label\">Select Reader or Editor </label>\n                  <div>\n                    <select\n                      class=\"form-select\"\n                      v-model=\"addUserIdentity\"\n                      required\n                    >\n                      <option>Reader</option>\n                      <option>Editor</option>\n                      <option>Admin</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n              <div class=\"card-footer text-end\">\n                <button\n                  type=\"submit\"\n                  class=\"btn btn-primary\"\n                  @onclick=\"addUser\"\n                >\n                  Submit\n                </button>\n              </div>\n            </fieldset>\n            <div class=\"card-footer text-end\"></div>\n          </form>\n        </div>\n\n        <div class=\"col-xl-8\" v-if=\"userIdentity.identity === 'Super-Admin'\">\n          <div class=\"card\">\n            <div class=\"card-header\">\n              <h3 class=\"card-title\">Recently Requests</h3>\n              \n            </div>\n            <div class=\"card-table table-responsive\">\n              <table class=\"table table-vcenter\">\n                <thead>\n                  <tr>\n                    <th>Request User Name</th>\n                    <th>Request User Cluster & Title</th>\n                    <th>Request Data Description</th>\n                    <th colspan=\"2\">Actions</th>\n                  </tr>\n                </thead>\n                <tr v-for=\"request in requestList\"  :key=\"request._id + new Date()\">\n                  <td>\n                    {{ request.userId && request.userId.email ? request.userId.email : 'user has been delete' }}\n                  </td>\n                  <td class=\"text-secondary\">\n                    {{ request.userId && request.userId.Cluster ? request.userId.Cluster : 'user has been delete' }}&{{ request.userId && request.userId.identity ? request.userId.identity : 'user has been delete' }}\n                  </td>\n                  <td class=\"text-secondary\">\n                    {{ request.userId && request.userId.name ? request.userId.name : 'user has been delete' }}申请了解{{\n                      request.partnerId.third_partner_name\n                    }}的{{ request.requestedContactField }}区域联系人信息\n                  </td>\n                  <td class=\"text-secondary\">\n                    <button @click=\"approveRequest(request._id)\">\n                      approve request\n                    </button>\n                    <button @click=\"denyRequest(request._id)\">\n                      deny request\n                    </button>\n                  </td>\n                  <td class=\"text-end w-1\">\n                    <div\n                      class=\"chart-sparkline chart-sparkline-sm\"\n                      id=\"sparkline-bounce-rate-1\"\n                    ></div>\n                  </td>\n                </tr>\n              </table>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-xl-8\" v-if=\"userIdentity.identity === 'Sales'\">\n          <div class=\"card\">\n            <div class=\"card-header\">\n              <h3 class=\"card-title\">Requests Feedback</h3>\n            </div>\n            <div class=\"card-table table-responsive\">\n              <table class=\"table table-vcenter\">\n                <thead>\n                  <tr>\n                    <th>Request Partner Name</th>\n                    <th>Request Time </th>\n                    <th>Request Partner Description</th>\n                    <th colspan=\"2\">Actions</th>\n                  </tr>\n                </thead>\n                <tr v-for=\"request in requestList\" :key=\"request._id + new Date()\">\n                  <td>\n                    {{ request.userId && request.userId.email ? request.userId.email : 'N/A' }}\n                  </td>\n                  <td class=\"text-secondary\">\n                    {{ request.requestedAt }}\n                  </td>\n                  <td class=\"text-secondary\">\n                    您申请了解的{{\n                      request.requestedContactField\n                    }}的区域联系人信息，目前已被{{request.status}}\n                  </td>\n                  <td class=\"text-secondary\">\n                    <button v-if=\"request.status === 'DENIED'\">\n                      delete request\n                    </button>\n                    <button v-if=\"request.status === 'APPROVED'\">\n                      view detail\n                    </button>\n                  \n                  </td>\n                  <td class=\"text-end w-1\">\n                    <div\n                      class=\"chart-sparkline chart-sparkline-sm\"\n                      id=\"sparkline-bounce-rate-1\"\n                    ></div>\n                  </td>\n                </tr>\n              </table>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div\n        class=\"toast\"\n        role=\"alert\"\n        aria-live=\"assertive\"\n        aria-atomic=\"true\"\n        ref=\"passwordToast\"\n      >\n        <div class=\"toast-header\">\n          <strong class=\"mr-auto\">Notification</strong>\n          <button\n            type=\"button\"\n            class=\"ml-2 mb-1 close\"\n            data-dismiss=\"toast\"\n            aria-label=\"Close\"\n          >\n            <span aria-hidden=\"true\"></span>\n          </button>\n        </div>\n        <div class=\"toast-body\">Password updated successfully!</div>\n      </div>\n\n      \n\n      <div class=\"user-authentication\" v-if=\"userIdentity.identity === 'Super-Admin'\">\n        user-settings\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h3 class=\"card-title\">user-authenticate</h3>\n          </div>\n          <div class=\"card-body\">\n            <div class=\"table-responsive\">\n              <table class=\"table mb-0\">\n                <thead>\n                  <tr>\n                    <th>User</th>\n                    <th>Role</th>\n                    <th>Action</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td>\n                      <select class=\"form-select\" v-model=\"selectedEmail\">\n                        <option value=\"\" disabled>Select User</option>\n                        <option\n                          v-for=\"user in allUsers\"\n                          :key=\"user.id\"\n                          :value=\"user.email\"\n                        >\n                          {{ user.email }}\n                        </option>\n                      </select>\n                    </td>\n                    <td>\n                      <select class=\"form-select\" v-model=\"selectedRole\">\n                        <option value=\"Reader\">Reader</option>\n                        <option value=\"Editor\">Editor</option>\n                        <option value=\"Admin\">Admin</option>\n                      </select>\n                    </td>\n                    <td>\n                      <button\n                        v-if=\"selectedEmail && selectedRole\"\n                        @click=\"updateUserRole\"\n                      >\n                        change Role\n                      </button>\n                    </td>\n                  </tr>\n                  <tr>\n                    <td>\n                      <select\n                        v-if=\"allUsers.length > 0\"\n                        v-model=\"selectedEmail\"\n                        class=\"form-select\"\n                      >\n                        <option\n                          v-for=\"user in allUsers\"\n                          :key=\"user.id\"\n                          :value=\"user.email\"\n                        >\n                          {{ user.email }}\n                        </option>\n                      </select>\n                      <div v-else>没有用户数据</div>\n                    </td>\n                    <td>\n                      <select class=\"form-select\">\n                        <option value=\"STATUS_CODE\" selected=\"\">Reader</option>\n                        <option value=\"JSON_BODY\">Editor</option>\n                        <option value=\"HEADERS\">Admin</option>\n                        <option value=\"TEXT_BODY\">Text body</option>\n                      </select>\n                    </td>\n                    <td>\n                      <button v-if=\"selectedEmail\" @click=\"deleteUser\">\n                        delete user\n                      </button>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n          <div class=\"card-footer text-end\">\n            <button type=\"submit\" class=\"btn btn-primary\">Make request</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script setup>\nimport { ref, onMounted, computed } from \"vue\";\nimport axios from \"../http\";\nimport { useStore } from \"vuex\";\n\nconst store = useStore();\nconst userIdentity = computed(() => store.getters.user);\nconst newPassword = ref(\"\");\nconst confirmNewPassword = ref(\"\");\nconst allUsers = ref([]);\nconst selectedEmail = ref(\"\");\nconst selectedRole = ref(\"\");\nconst updatedUserRole = ref(\"\");\nconst addUserEmail = ref(\"\");\nconst addUserPassword = ref(\"\");\nconst addUserIdentity = ref(\"\");\nconst addUserName = ref(\"\");\nconst requestList = ref([]);\n\n\nonMounted(async () => {\n  await getUsers();\n  await requestLists(userIdentity);\n});\n\nconst getUsers = async () => {\n  try {\n    let { data } = await axios.get(\"/api/users\");\n    allUsers.value = data;\n  } catch (error) {}\n};\nconst changePassword = () => {\n  if (newPassword.value !== confirmNewPassword.value) {\n    alert(\"password not match\");\n    return;\n  }\n  axios\n    .post(\"/api/users/edit-user/password\", {\n      newPassword: newPassword.value,\n    })\n    .then((response) => {\n      console.log(\"password update successfully \");\n    })\n    .catch((error) => {\n      console.log(\"failed to update password\");\n    });\n};\n//需要完善计算属性或重新刷新页面的问题\nconst deleteUser = async () => {\n  try {\n    await axios.delete(\"/api/users/delete/user\", {\n      data: { email: selectedEmail.value },\n    });\n    await getUsers();\n    selectedEmail = null;\n  } catch (error) {\n    console.log(\"error deleting user:\", error);\n  }\n};\nconst updateUserRole = async () => {\n  try {\n    await axios.put(\"/api/users/edit/role\", {\n      email: selectedEmail.value,\n      updatedUserRole: selectedRole.value,\n    });\n\n    await getUsers();\n  } catch (error) {\n    console.log(\"error editor user role:\", error);\n  }\n};\n\nconst addUser = async () => {\n  try {\n    await axios.post(\"/api/users/register\", {\n      name: addUserName.value,\n      email: addUserEmail.value,\n      password: addUserPassword.value,\n      identity: addUserIdentity.value,\n    });\n    await getUsers();\n  } catch (error) {\n    console.log(\"error add user \", error);\n  }\n};\n\nconst requestLists = async (userIdentity) => {\n  try {\n    console.log(userIdentity)\n    if (userIdentity.value.identity === \"Super-Admin\") {\n      \n      let { data } = await axios.get(\"/api/accessQuests/all-requests\", {\n        params: { status: \"PENDING\" },\n      });\n      requestList.value = data;\n      console.log(requestList)\n    } else if (userIdentity.value.identity === \"Sales\" || userIdentity.value.identity === \"Team-Leader\") {\n      let { data } = await axios.get(`/api/accessQuests/user-requests/${userIdentity.value.id}`);\n      \n      requestList.value = data;\n    }\n\n    console.log(requestList.value);\n  } catch (error) {\n    console.log(\"error get request list\", error);\n  }\n};\n\n\nconst approveRequest = async (value) => {\n  try {\n    await axios.put(\"/api/accessQuests/all-requests/\" + value, {\n      status: \"APPROVED\",\n    });\n  } catch (error) {\n    console.log(\"error approve request\", error);\n  }\n};\nconst denyRequest = async (value) => {\n  try {\n    await axios.put(\"/api/accessQuests/all-requests/\" + value, {\n      status: \"DENIED\",\n    });\n  } catch (error) {\n    console.log(\"error approve request\", error);\n  }\n};\n</script>\n","import script from \"./Personal.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Personal.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["store","useStore","userIdentity","computed","getters","user","newPassword","ref","confirmNewPassword","allUsers","selectedEmail","selectedRole","addUserEmail","addUserPassword","addUserIdentity","addUserName","requestList","onMounted","async","getUsers","requestLists","data","axios","value","error","changePassword","then","response","console","log","catch","alert","deleteUser","email","updateUserRole","updatedUserRole","addUser","name","password","identity","params","status","id","approveRequest","denyRequest","__exports__"],"sourceRoot":""}